<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grammar Test - Grade 3</title>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: 0 auto;
      background: #f0f8ff;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    h1 {
      color: #2196F3;
      margin-bottom: 5px;
    }
    
    /* CONTROLS BAR */
    .top-controls {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .score-display {
      font-size: 18px;
      font-weight: bold;
      color: #2196F3;
    }
    
    /* QUESTION NAVIGATION */
    .question-nav {
      background: white;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .nav-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      background: #f0f8ff;
      color: #2196F3;
      border: 2px solid #2196F3;
    }
    
    .nav-btn:hover:not(:disabled) {
      background: #2196F3;
      color: white;
    }
    
    .nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .question-counter {
      font-weight: bold;
      color: #333;
    }
    
    /* QUESTION BOX */
    .question-box {
      background: white;
      padding: 25px;
      margin: 20px 0;
      border-radius: 10px;
      border-left: 6px solid #2196F3;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    
    .question-number {
      background: #2196F3;
      color: white;
      display: inline-block;
      padding: 8px 15px;
      border-radius: 5px;
      margin-bottom: 15px;
      font-weight: bold;
      font-size: 18px;
    }
    
    .question-text {
      font-size: 20px;
      margin: 20px 0;
      color: #333;
      line-height: 1.5;
    }
    
    /* OPTIONS */
    .options {
      margin: 20px 0;
    }
    
    .option {
      padding: 15px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      background: white;
      transition: all 0.2s;
      font-size: 17px;
    }
    
    .option:hover {
      background: #f5faff;
      border-color: #bbdefb;
    }
    
    .selected {
      border-color: #2196F3;
      background: #e3f2fd;
      font-weight: bold;
    }
    
    .correct {
      border-color: #4CAF50;
      background: #e8f5e9;
    }
    
    .incorrect {
      border-color: #f44336;
      background: #ffebee;
    }
    
    /* FEEDBACK */
    .feedback {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
      animation: fadeIn 0.5s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .feedback-correct {
      background: #e8f5e9;
      border-left: 4px solid #4CAF50;
      color: #2e7d32;
    }
    
    .feedback-incorrect {
      background: #ffebee;
      border-left: 4px solid #f44336;
      color: #c62828;
    }
    
    /* ACTION BUTTONS */
    .action-buttons {
      text-align: center;
      margin: 25px 0;
    }
    
    button {
      padding: 12px 25px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px 10px;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: #2196F3;
      color: white;
    }
    
    .btn-primary:hover {
      background: #1976D2;
      transform: translateY(-2px);
    }
    
    .btn-success {
      background: #4CAF50;
      color: white;
    }
    
    .btn-success:hover {
      background: #388E3C;
      transform: translateY(-2px);
    }
    
    .btn-warning {
      background: #FF9800;
      color: white;
    }
    
    .btn-warning:hover {
      background: #F57C00;
      transform: translateY(-2px);
    }
    
    .btn-danger {
      background: #f44336;
      color: white;
    }
    
    .btn-danger:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }
    
    /* RESULTS SECTION */
    .results-container {
      display: none;
      background: white;
      padding: 30px;
      border-radius: 10px;
      margin: 20px 0;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      text-align: center;
      animation: fadeIn 0.8s;
    }
    
    .result-score {
      font-size: 52px;
      color: #2196F3;
      font-weight: bold;
      margin: 15px 0;
    }
    
    .result-message {
      font-size: 22px;
      color: #333;
      margin: 15px 0;
    }
    
    .result-details {
      text-align: left;
      margin: 25px 0;
      max-height: 400px;
      overflow-y: auto;
      padding: 10px;
      border: 2px solid #f0f0f0;
      border-radius: 8px;
    }
    
    .result-item {
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
      border-left: 4px solid #ddd;
    }
    
    .result-correct {
      background: #f1f8e9;
      border-left-color: #4CAF50;
    }
    
    .result-incorrect {
      background: #ffebee;
      border-left-color: #f44336;
    }
    
    /* PROGRESS BAR */
    .progress-container {
      margin: 20px 0;
    }
    
    .progress-bar {
      width: 100%;
      height: 10px;
      background: #e0e0e0;
      border-radius: 5px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2196F3, #1976D2);
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .progress-text {
      text-align: right;
      margin-top: 5px;
      color: #666;
      font-size: 14px;
    }
    
    /* BACK BUTTON */
    .back-btn {
      display: inline-block;
      margin-top: 20px;
      padding: 12px 20px;
      background: #666;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
      transition: background 0.3s;
    }
    
    .back-btn:hover {
      background: #555;
    }
    
    /* ANSWER STATUS INDICATOR */
    .answer-status {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin: 15px 0;
    }
    
    .status-dot {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      cursor: pointer;
      border: 2px solid #ddd;
      background: white;
    }
    
    .status-dot.answered {
      background: #2196F3;
      color: white;
      border-color: #2196F3;
    }
    
    .status-dot.current {
      border: 3px solid #FF9800;
      transform: scale(1.1);
    }
  </style>
</head>

<body>
  <!-- HEADER -->
  <div class="header">
    <h1>üìö Grammar Test - Grade 3</h1>
    <p>Complete all 30 questions and check your answers</p>
  </div>
  
  <!-- TOP CONTROLS -->
  <div class="top-controls">
    <div class="score-display">
      Score: <span id="score">0</span>/<span id="total-questions">30</span>
    </div>
    <div>
      <button class="btn-warning" onclick="shuffleQuestions()">üîÄ Shuffle Questions</button>
      <button class="btn-danger" onclick="resetTest()">üîÑ Reset Test</button>
    </div>
  </div>
  
  <!-- PROGRESS BAR -->
  <div class="progress-container">
    <div class="progress-bar">
      <div id="progress-fill" class="progress-fill"></div>
    </div>
    <div class="progress-text">
      Progress: <span id="progress-text">0%</span>
    </div>
  </div>
  
  <!-- ANSWER STATUS INDICATOR -->
  <div class="answer-status" id="answer-status">
    <!-- Dots will be generated by JavaScript -->
  </div>
  
  <!-- QUESTION NAVIGATION -->
  <div class="question-nav">
    <button class="nav-btn" onclick="prevQuestion()" id="prev-btn">‚Üê Previous</button>
    <div class="question-counter">
      Question <span id="current-q-num">1</span> of <span id="total-q">30</span>
    </div>
    <button class="nav-btn" onclick="nextQuestion()" id="next-btn">Next ‚Üí</button>
  </div>
  
  <!-- QUIZ CONTAINER -->
  <div id="quiz-container">
    <!-- Questions will be loaded here -->
  </div>
  
  <!-- CHECK BUTTONS -->
  <div class="action-buttons">
    <button class="btn-success" onclick="checkCurrentAnswer()">‚úì Check This Answer</button>
    <button class="btn-primary" onclick="checkAllAnswers()">‚úÖ Submit All Answers</button>
  </div>
  
  <!-- RESULTS CONTAINER -->
  <div id="results-container" class="results-container">
    <h2>Test Results - Grade 3</h2>
    <div class="result-score" id="final-score">0%</div>
    <div class="result-message" id="result-message">Well done!</div>
    
    <div id="result-details" class="result-details">
      <!-- Results will be displayed here -->
    </div>
    
    <div style="margin-top: 25px;">
      <button class="btn-warning" onclick="reviewAnswers()">üìñ Review All Answers</button>
      <button class="btn-primary" onclick="retryTest()">üîÑ Try Again</button>
      <a href="grammar.html" class="btn-success" style="padding: 12px 20px; text-decoration: none; display: inline-block;">Back to Grade Selection</a>
    </div>
  </div>
  
  <!-- BACK BUTTON -->
  <div style="text-align: center; margin-top: 30px;">
    <a href="grammar.html" class="back-btn">‚Üê Back to Grade Selection</a>
  </div>

  <script>
    // ============================================
    // QUESTION DATA FOR GRADE 3
    // ============================================
    const questionsData = [
      {
        id: 1,
        question: "She bought ___ orange and a banana.",
        options: ["the", "a", "an", "some"],
        correctAnswer: 2,
        explanation: "We use 'an' before words that start with a vowel sound. 'Orange' starts with a vowel (o)."
      },
      {
        id: 2,
        question: "My mother is a ___, and my father is a ___.",
        options: ["woman/man", "girl/boy", "aunt/uncle", "she/he"],
        correctAnswer: 0,
        explanation: "The correct terms for adults are 'woman' (female adult) and 'man' (male adult)."
      },
      {
        id: 3,
        question: "___ is your teacher talking to?",
        options: ["What", "Who", "When", "How"],
        correctAnswer: 1,
        explanation: "'Who' is used to ask about people. We use 'who' for questions about persons."
      },
      {
        id: 4,
        question: "We ___ a picnic next Sunday.",
        options: ["had", "have", "are having", "will have"],
        correctAnswer: 3,
        explanation: "'Will have' is the correct future tense for a plan. 'Next Sunday' indicates future time."
      },
      {
        id: 5,
        question: "Apples are ___, but rice is ___.",
        options: ["countable/uncountable", "uncountable/countable", "plural/singular", "proper/common"],
        correctAnswer: 0,
        explanation: "Apples are countable nouns (you can count them: 1 apple, 2 apples). Rice is uncountable (you cannot count individual grains)."
      },
      {
        id: 6,
        question: "He ran ___.",
        options: ["quick", "fastly", "quickly", "quicker"],
        correctAnswer: 2,
        explanation: "'Quickly' is the correct adverb to describe the verb 'ran'. Adverbs often end with -ly."
      },
      {
        id: 7,
        question: "I ___ dinner when you called.",
        options: ["was eating", "ate", "am eating", "eat"],
        correctAnswer: 0,
        explanation: "Past continuous tense ('was eating') is used for an ongoing action in the past when another action occurred."
      },
      {
        id: 8,
        question: "___ do you go to school? ‚Äì By bus.",
        options: ["Where", "How", "When", "What"],
        correctAnswer: 1,
        explanation: "'How' asks about the method or way of doing something. 'By bus' answers 'how'."
      },
      {
        id: 9,
        question: "Michael and Sarah are ___ nouns.",
        options: ["proper", "common", "plural", "general"],
        correctAnswer: 0,
        explanation: "Names of people (Michael, Sarah) are proper nouns. Proper nouns start with capital letters."
      },
      {
        id: 10,
        question: "Which sentence has the correct punctuation?",
        options: ["She likes pizza, and pasta", "She likes pizza and pasta", "She likes pizza, and pasta.", "She likes pizza and pasta."],
        correctAnswer: 3,
        explanation: "A simple sentence with 'and' doesn't need a comma, and it must end with a period (full stop)."
      },
      {
        id: 11,
        question: "I saw ___ elephant at the zoo.",
        options: ["a", "an", "the", "some"],
        correctAnswer: 1,
        explanation: "'An' is used before words starting with a vowel sound. 'Elephant' starts with a vowel sound (e)."
      },
      {
        id: 12,
        question: "He speaks English ___.",
        options: ["good", "better", "well", "best"],
        correctAnswer: 2,
        explanation: "'Well' is the correct adverb to describe the verb 'speaks'. 'Good' is an adjective."
      },
      {
        id: 13,
        question: "Do you want tea ___ coffee?",
        options: ["or", "and", "but", "so"],
        correctAnswer: 0,
        explanation: "'Or' is used for alternative choices (this OR that). 'And' is for adding things together."
      },
      {
        id: 14,
        question: "We need ___ milk to make the cake.",
        options: ["a", "many", "some", "an"],
        correctAnswer: 2,
        explanation: "'Some' is used with uncountable nouns like 'milk'. We don't use 'a' or 'an' with uncountable nouns."
      },
      {
        id: 15,
        question: "The room is ___ than before.",
        options: ["clean", "cleaner", "cleanest", "cleaning"],
        correctAnswer: 1,
        explanation: "'Cleaner' is the comparative form used when comparing two things. Add -er for short adjectives."
      },
      {
        id: 16,
        question: "They ___ in my room yesterday.",
        options: ["are", "has been", "were", "is"],
        correctAnswer: 2,
        explanation: "'Were' is the past tense of 'are' for the subject 'they'. 'Yesterday' indicates past time."
      },
      {
        id: 17,
        question: "___ is your name?",
        options: ["Where", "When", "What", "Why"],
        correctAnswer: 2,
        explanation: "'What' is used to ask for information about something. We ask 'What is your name?'"
      },
      {
        id: 18,
        question: "My sister lives in ___ London.",
        options: ["the", "a", "an", "‚Äì (no article)"],
        correctAnswer: 3,
        explanation: "City names typically don't use articles (no article needed). We don't say 'the London' or 'a London'."
      },
      {
        id: 19,
        question: "He ___ his homework now.",
        options: ["does", "did", "is doing", "will do"],
        correctAnswer: 2,
        explanation: "'Is doing' is the present continuous tense for actions happening now. 'Now' indicates present continuous."
      },
      {
        id: 20,
        question: "She is a ___ girl.",
        options: ["beautiful", "beautifully", "beauty", "beautify"],
        correctAnswer: 0,
        explanation: "'Beautiful' is the correct adjective to describe the noun 'girl'. Adjectives describe nouns."
      },
      {
        id: 21,
        question: "Which one is a female term?",
        options: ["waiter", "father", "queen", "king"],
        correctAnswer: 2,
        explanation: "'Queen' is a female term (female monarch). Waiter can be male or female (waitress is female)."
      },
      {
        id: 22,
        question: "The ball is ___ the table. [picture: ball under table]",
        options: ["in", "on", "under", "over"],
        correctAnswer: 2,
        explanation: "Based on the picture description, the ball is under the table. 'Under' means below something."
      },
      {
        id: 23,
        question: "Choose the correct punctuation:",
        options: ["I have a dog a cat and a rabbit.", "I have a dog, a cat, and a rabbit.", "I have, a dog a cat, and a rabbit.", "I have a dog and, a cat and a rabbit."],
        correctAnswer: 1,
        explanation: "In a list of three or more items, we use commas to separate the items (Oxford comma is optional but correct)."
      },
      {
        id: 24,
        question: "My uncle is a ___ and my aunt is a ___.",
        options: ["man/man", "boy/girl", "brother/sister", "man/woman"],
        correctAnswer: 3,
        explanation: "The correct terms for uncle and aunt are 'man' (adult male) and 'woman' (adult female)."
      },
      {
        id: 25,
        question: "___ do you go to school? ‚Äì By bus.",
        options: ["Where", "How", "When", "What"],
        correctAnswer: 1,
        explanation: "'How' asks about the method or way of doing something. 'By bus' answers 'how'."
      },
      {
        id: 26,
        question: "We are ______ school now.",
        options: ["before", "at", "of", "and"],
        correctAnswer: 1,
        explanation: "'At school' is the correct phrase to indicate location. We use 'at' for specific places."
      },
      {
        id: 27,
        question: "They ___ a movie last night.",
        options: ["watch", "watching", "watched", "watches"],
        correctAnswer: 2,
        explanation: "'Watched' is the past tense of 'watch'. 'Last night' indicates past time."
      },
      {
        id: 28,
        question: "It is a ___ day.",
        options: ["sun", "sunny", "sunning", "sunnily"],
        correctAnswer: 1,
        explanation: "'Sunny' is the correct adjective to describe the noun 'day'. Adjectives describe nouns."
      },
      {
        id: 29,
        question: "___ is your teacher talking to?",
        options: ["What", "Who", "When", "How"],
        correctAnswer: 1,
        explanation: "'Who' is used to ask about people. We use 'who' for questions about persons."
      },
      {
        id: 30,
        question: "She ___ to school every day.",
        options: ["go", "goes", "going", "went"],
        correctAnswer: 1,
        explanation: "'Goes' is the present tense form for third person singular (she/he/it). Add -es because 'go' ends with -o."
      }
    ];

    // ============================================
    // QUIZ STATE MANAGEMENT
    // ============================================
    let questions = [...questionsData];
    let userAnswers = {};
    let answerStatus = {}; // Track if answer is checked
    let currentQuestionIndex = 0;
    let score = 0;
    let isReviewMode = false;
    let showAnswers = false;

    // ============================================
    // INITIALIZE QUIZ
    // ============================================
    function initQuiz() {
      document.getElementById('total-questions').textContent = questions.length;
      document.getElementById('total-q').textContent = questions.length;
      loadQuestion(currentQuestionIndex);
      updateProgress();
      generateStatusDots();
      updateNavigationButtons();
    }

    // ============================================
    // LOAD QUESTION
    // ============================================
    function loadQuestion(index) {
      currentQuestionIndex = index;
      const question = questions[index];
      
      document.getElementById('current-q-num').textContent = index + 1;
      
      let optionsHTML = '';
      const optionLetters = ['a', 'b', 'c', 'd'];
      
      question.options.forEach((option, i) => {
        let optionClass = 'option';
        
        // Check if this option was selected
        if (userAnswers[question.id] === i) {
          optionClass += ' selected';
        }
        
        // Check if we're showing answers
        if (showAnswers && answerStatus[question.id]) {
          if (i === question.correctAnswer) {
            optionClass += ' correct';
          } else if (userAnswers[question.id] === i && i !== question.correctAnswer) {
            optionClass += ' incorrect';
          }
        }
        
        optionsHTML += `
          <div class="${optionClass}" onclick="selectAnswer(${question.id}, ${i})">
            ${optionLetters[i]}) ${option}
          </div>
        `;
      });
      
      // Check if we need to show feedback
      let feedbackHTML = '';
      if (showAnswers && answerStatus[question.id]) {
        const isCorrect = userAnswers[question.id] === question.correctAnswer;
        feedbackHTML = `
          <div class="feedback ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'}" style="display: block;">
            <strong>${isCorrect ? '‚úì Correct!' : '‚úó Incorrect!'}</strong><br>
            ${question.explanation}
          </div>
        `;
      }
      
      const questionHTML = `
        <div class="question-box">
          <div class="question-number">Question ${index + 1}</div>
          <div class="question-text">${question.question}</div>
          <div class="options">${optionsHTML}</div>
          ${feedbackHTML}
        </div>
      `;
      
      document.getElementById('quiz-container').innerHTML = questionHTML;
      updateProgress();
      updateStatusDots();
      updateNavigationButtons();
    }

    // ============================================
    // GENERATE STATUS DOTS
    // ============================================
    function generateStatusDots() {
      let dotsHTML = '';
      for (let i = 0; i < questions.length; i++) {
        const isAnswered = userAnswers[questions[i].id] !== undefined;
        const isCurrent = i === currentQuestionIndex;
        dotsHTML += `
          <div class="status-dot ${isAnswered ? 'answered' : ''} ${isCurrent ? 'current' : ''}" 
               onclick="jumpToQuestion(${i})">
            ${i + 1}
          </div>
        `;
      }
      document.getElementById('answer-status').innerHTML = dotsHTML;
    }

    // ============================================
    // UPDATE STATUS DOTS
    // ============================================
    function updateStatusDots() {
      const dots = document.querySelectorAll('.status-dot');
      dots.forEach((dot, index) => {
        const isAnswered = userAnswers[questions[index].id] !== undefined;
        const isCurrent = index === currentQuestionIndex;
        
        dot.className = 'status-dot';
        if (isAnswered) dot.classList.add('answered');
        if (isCurrent) dot.classList.add('current');
      });
    }

    // ============================================
    // JUMP TO SPECIFIC QUESTION
    // ============================================
    function jumpToQuestion(index) {
      loadQuestion(index);
    }

    // ============================================
    // SELECT ANSWER
    // ============================================
    function selectAnswer(questionId, optionIndex) {
      if (showAnswers && answerStatus[questionId]) return; // Don't allow change if already checked
      
      userAnswers[questionId] = optionIndex;
      loadQuestion(currentQuestionIndex);
    }

    // ============================================
    // CHECK CURRENT ANSWER
    // ============================================
    function checkCurrentAnswer() {
      const currentQuestion = questions[currentQuestionIndex];
      
      if (userAnswers[currentQuestion.id] === undefined) {
        alert("Please select an answer first!");
        return;
      }
      
      // Mark this question as checked
      answerStatus[currentQuestion.id] = true;
      
      // Update score if correct
      if (userAnswers[currentQuestion.id] === currentQuestion.correctAnswer) {
        score++;
        document.getElementById('score').textContent = score;
      }
      
      // Show feedback
      showAnswers = true;
      loadQuestion(currentQuestionIndex);
      
      // Auto-advance to next question after 1.5 seconds
      setTimeout(() => {
        if (currentQuestionIndex < questions.length - 1) {
          nextQuestion();
        } else {
          // If this is the last question, ask if they want to submit
          if (confirm("This is the last question. Submit all answers now?")) {
            checkAllAnswers();
          }
        }
      }, 1500);
    }

    // ============================================
    // CHECK ALL ANSWERS
    // ============================================
    function checkAllAnswers() {
      // Check if all questions are answered
      const unansweredQuestions = questions.filter(q => userAnswers[q.id] === undefined);
      
      if (unansweredQuestions.length > 0) {
        if (!confirm(`You have ${unansweredQuestions.length} unanswered question(s). Submit anyway?`)) {
          return;
        }
      }
      
      // Mark all questions as checked
      questions.forEach(q => {
        answerStatus[q.id] = true;
      });
      
      // Calculate score
      score = 0;
      questions.forEach(question => {
        if (userAnswers[question.id] === question.correctAnswer) {
          score++;
        }
      });
      
      // Update score display
      document.getElementById('score').textContent = score;
      
      // Show answers
      showAnswers = true;
      loadQuestion(currentQuestionIndex);
      
      // Show results after a delay
      setTimeout(showResults, 1000);
    }

    // ============================================
    // SHOW RESULTS
    // ============================================
    function showResults() {
      const percentage = Math.round((score / questions.length) * 100);
      
      document.getElementById('final-score').textContent = `${percentage}%`;
      
      // Set result message
      let message = '';
      let emoji = '';
      
      if (percentage === 100) {
        message = "Perfect Score! üéâ";
        emoji = "üèÜ";
      } else if (percentage >= 90) {
        message = "Excellent! üåü";
        emoji = "‚≠ê";
      } else if (percentage >= 80) {
        message = "Very Good! üëç";
        emoji = "üòä";
      } else if (percentage >= 70) {
        message = "Good Job!";
        emoji = "üôÇ";
      } else if (percentage >= 60) {
        message = "Not Bad!";
        emoji = "üëç";
      } else {
        message = "Keep Practicing!";
        emoji = "üìö";
      }
      
      document.getElementById('result-message').innerHTML = `${message} ${emoji}<br>You got ${score} out of ${questions.length} correct`;
      
      // Build result details
      let detailsHTML = '';
      questions.forEach((question, index) => {
        const userAnswer = userAnswers[question.id];
        const isCorrect = userAnswer === question.correctAnswer;
        const optionLetters = ['a', 'b', 'c', 'd'];
        
        detailsHTML += `
          <div class="result-item ${isCorrect ? 'result-correct' : 'result-incorrect'}">
            <strong>Q${index + 1}:</strong> ${question.question}<br>
            <small>Your answer: ${userAnswer !== undefined ? optionLetters[userAnswer] + '. ' + question.options[userAnswer] : 'Not answered'}</small><br>
            <small>Correct answer: ${optionLetters[question.correctAnswer]}. ${question.options[question.correctAnswer]}</small>
            ${!isCorrect ? `<br><small><em>üí° ${question.explanation}</em></small>` : ''}
          </div>
        `;
      });
      
      document.getElementById('result-details').innerHTML = detailsHTML;
      
      // Hide quiz, show results
      document.getElementById('quiz-container').style.display = 'none';
      document.querySelector('.question-nav').style.display = 'none';
      document.querySelector('.action-buttons').style.display = 'none';
      document.querySelector('.progress-container').style.display = 'none';
      document.getElementById('answer-status').style.display = 'none';
      document.getElementById('results-container').style.display = 'block';
    }

    // ============================================
    // NAVIGATION FUNCTIONS
    // ============================================
    function prevQuestion() {
      if (currentQuestionIndex > 0) {
        loadQuestion(currentQuestionIndex - 1);
      }
    }

    function nextQuestion() {
      if (currentQuestionIndex < questions.length - 1) {
        loadQuestion(currentQuestionIndex + 1);
      }
    }

    function updateNavigationButtons() {
      document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
      document.getElementById('next-btn').disabled = currentQuestionIndex === questions.length - 1;
    }

    // ============================================
    // SHUFFLE QUESTIONS
    // ============================================
    function shuffleQuestions() {
      if (!confirm("Shuffle questions and restart test?")) return;
      
      // Shuffle array
      for (let i = questions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questions[i], questions[j]] = [questions[j], questions[i]];
      }
      
      resetTest();
      alert("Questions shuffled! Test restarted.");
    }

    // ============================================
    // RESET TEST
    // ============================================
    function resetTest() {
      userAnswers = {};
      answerStatus = {};
      score = 0;
      currentQuestionIndex = 0;
      showAnswers = false;
      isReviewMode = false;
      
      // Reset displays
      document.getElementById('score').textContent = '0';
      document.getElementById('quiz-container').style.display = 'block';
      document.querySelector('.question-nav').style.display = 'flex';
      document.querySelector('.action-buttons').style.display = 'block';
      document.querySelector('.progress-container').style.display = 'block';
      document.getElementById('answer-status').style.display = 'flex';
      document.getElementById('results-container').style.display = 'none';
      
      loadQuestion(currentQuestionIndex);
    }

    // ============================================
    // REVIEW ANSWERS
    // ============================================
    function reviewAnswers() {
      isReviewMode = true;
      showAnswers = true;
      currentQuestionIndex = 0;
      
      document.getElementById('results-container').style.display = 'none';
      document.getElementById('quiz-container').style.display = 'block';
      document.querySelector('.question-nav').style.display = 'flex';
      document.querySelector('.action-buttons').style.display = 'block';
      document.querySelector('.progress-container').style.display = 'block';
      document.getElementById('answer-status').style.display = 'flex';
      
      loadQuestion(currentQuestionIndex);
    }

    // ============================================
    // RETRY TEST
    // ============================================
    function retryTest() {
      resetTest();
    }

    // ============================================
    // UPDATE PROGRESS
    // ============================================
    function updateProgress() {
      const answered = Object.keys(userAnswers).length;
      const progress = (answered / questions.length) * 100;
      
      document.getElementById('progress-fill').style.width = `${progress}%`;
      document.getElementById('progress-text').textContent = `${Math.round(progress)}%`;
    }

    // ============================================
    // START THE QUIZ
    // ============================================
    document.addEventListener('DOMContentLoaded', initQuiz);
  </script>
</body>
</html>